{{- if .Values.workers.price.enabled }}
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "poslite-pam.fullname" . }}-price-worker
  labels:
    {{- include "poslite-pam.labels" . | nindent 4 }}
    component: worker
    worker-type: price
spec:
  replicas: {{ .Values.workers.price.replicas }}
  selector:
    matchLabels:
      {{- include "poslite-pam.selectorLabels" . | nindent 6 }}
      component: worker
      worker-type: price
  template:
    metadata:
      labels:
        {{- include "poslite-pam.selectorLabels" . | nindent 8 }}
        component: worker
        worker-type: price
    spec:
      {{- if .Values.imagePullSecrets }}
      imagePullSecrets:
        {{- toYaml .Values.imagePullSecrets | nindent 8 }}
      {{- end }}
      containers:
      - name: worker
        image: "{{ .Values.imageRegistry }}/{{ .Values.imageRepository }}/{{ .Values.workers.price.image.repository }}:{{ .Values.workers.price.image.tag }}"
        imagePullPolicy: {{ .Values.pullPolicy | default "Always" }}
        securityContext:
          runAsUser: 0
        env:
        - name: TZ
          value: {{ .Values.config.timezone }}
        - name: ConnectionStrings:CoreDbConnection
          valueFrom:
            secretKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: db-connection-string
        - name: ASPNETCORE_ENVIRONMENT
          value: "Development"
        - name: GuardApi:Url
          value: "http://{{ include "poslite-pam.guardApiService" . }}:{{ .Values.guardApi.port }}/guard/status"
        - name: CoreApiClient:BaseUrl
          value: "http://{{ include "poslite-pam.coreWebapiService" . }}:{{ .Values.coreWebapi.port }}/"
        - name: CoreApiClient:ApiKey
          value: {{ .Values.config.coreApiKey | quote }}
        - name: PROCESS
          value: "scheduledPriceChange"
        workingDir: /app
        resources:
          {{- toYaml .Values.resources | nindent 10 }}
      hostname: pam-core-price-worker
      {{- with .Values.nodeSelector }}
      nodeSelector:
        {{- toYaml . | nindent 8 }}
      {{- end }}
{{- end }}

---
{{- if .Values.workers.shift.enabled }}
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "poslite-pam.fullname" . }}-shift-worker
  labels:
    {{- include "poslite-pam.labels" . | nindent 4 }}
    component: worker
    worker-type: shift
spec:
  replicas: {{ .Values.workers.shift.replicas }}
  selector:
    matchLabels:
      {{- include "poslite-pam.selectorLabels" . | nindent 6 }}
      component: worker
      worker-type: shift
  template:
    metadata:
      labels:
        {{- include "poslite-pam.selectorLabels" . | nindent 8 }}
        component: worker
        worker-type: shift
    spec:
      {{- if .Values.imagePullSecrets }}
      imagePullSecrets:
        {{- toYaml .Values.imagePullSecrets | nindent 8 }}
      {{- end }}
      containers:
      - name: worker
        image: "{{ .Values.imageRegistry }}/{{ .Values.imageRepository }}/{{ .Values.workers.shift.image.repository }}:{{ .Values.workers.shift.image.tag }}"
        imagePullPolicy: {{ .Values.pullPolicy | default "Always" }}
        securityContext:
          runAsUser: 0
        env:
        - name: ConnectionStrings:CoreDbConnection
          valueFrom:
            secretKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: db-connection-string
        - name: GasStationBackend:pamBaseUrl
          value: "http://pam-webapi:8080/"
        - name: GasStationBackend:Backend
          value: "pam"
        - name: TZ
          value: {{ .Values.config.timezone }}
        - name: GuardApi:Url
          value: "http://{{ include "poslite-pam.guardApiService" . }}:{{ .Values.guardApi.port }}/guard/status"
        - name: CoreApiClient:BaseUrl
          value: "http://{{ include "poslite-pam.coreWebapiService" . }}:{{ .Values.coreWebapi.port }}/"
        - name: CoreApiClient:ApiKey
          value: {{ .Values.config.coreApiKey | quote }}
        - name: PROCESS
          value: "scheduledShiftChange"
        - name: Workers:ScheduledShiftChange:CronExpression
          value: "* * * * *"
        workingDir: /app
        resources:
          {{- toYaml .Values.resources | nindent 10 }}
      hostname: pam-core-shift-worker
      {{- with .Values.nodeSelector }}
      nodeSelector:
        {{- toYaml . | nindent 8 }}
      {{- end }}
{{- end }}

---
{{- if .Values.workers.errorReports.enabled }}
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "poslite-pam.fullname" . }}-error-reports-worker
  labels:
    {{- include "poslite-pam.labels" . | nindent 4 }}
    component: worker
    worker-type: error-reports
spec:
  replicas: {{ .Values.workers.errorReports.replicas }}
  selector:
    matchLabels:
      {{- include "poslite-pam.selectorLabels" . | nindent 6 }}
      component: worker
      worker-type: error-reports
  template:
    metadata:
      labels:
        {{- include "poslite-pam.selectorLabels" . | nindent 8 }}
        component: worker
        worker-type: error-reports
    spec:
      {{- if .Values.imagePullSecrets }}
      imagePullSecrets:
        {{- toYaml .Values.imagePullSecrets | nindent 8 }}
      {{- end }}
      containers:
      - name: worker
        image: "{{ .Values.imageRegistry }}/{{ .Values.imageRepository }}/{{ .Values.workers.errorReports.image.repository }}:{{ .Values.workers.errorReports.image.tag }}"
        imagePullPolicy: {{ .Values.pullPolicy | default "Always" }}
        securityContext:
          runAsUser: 0
        env:
        - name: TZ
          value: {{ .Values.config.timezone }}
        - name: ConnectionStrings:CoreDbConnection
          valueFrom:
            secretKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: db-connection-string
        - name: ASPNETCORE_ENVIRONMENT
          value: "Development"
        - name: GuardApi:Url
          value: "http://{{ include "poslite-pam.guardApiService" . }}:{{ .Values.guardApi.port }}/guard/status"
        - name: CoreApiClient:BaseUrl
          value: "http://{{ include "poslite-pam.coreWebapiService" . }}:{{ .Values.coreWebapi.port }}/"
        - name: CoreApiClient:ApiKey
          value: "TEST"
        - name: PROCESS
          value: "none"
        - name: SendEmailProccess
          value: "true"
        - name: Workers:BasicData:CronExpressionEmail
          value: "0 12,18 * * *"
        - name: SmtpSettings:From
          value: "noreplyasptg@asptg.com"
        - name: SmtpSettings:To
          valueFrom:
            configMapKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: smtp-to
        - name: SmtpSettings:Host
          value: "smtp.office365.com"
        - name: SmtpSettings:Port
          value: "587"
        - name: SmtpSettings:EnableSsl
          value: "true"
        - name: SmtpSettings:UserName
          value: "noreplyasptg@asptg.com"
        - name: SmtpSettings:Password
          valueFrom:
            secretKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: smtp-password
        workingDir: /app
        resources:
          {{- toYaml .Values.resources | nindent 10 }}
      hostname: pam-error-reports-worker
      {{- with .Values.nodeSelector }}
      nodeSelector:
        {{- toYaml . | nindent 8 }}
      {{- end }}
{{- end }}

---
{{- if .Values.workers.dispatches.enabled }}
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "poslite-pam.fullname" . }}-dispatches-dataworker
  labels:
    {{- include "poslite-pam.labels" . | nindent 4 }}
    component: worker
    worker-type: dispatches
spec:
  replicas: {{ .Values.workers.dispatches.replicas }}
  selector:
    matchLabels:
      {{- include "poslite-pam.selectorLabels" . | nindent 6 }}
      component: worker
      worker-type: dispatches
  template:
    metadata:
      labels:
        {{- include "poslite-pam.selectorLabels" . | nindent 8 }}
        component: worker
        worker-type: dispatches
    spec:
      {{- if .Values.imagePullSecrets }}
      imagePullSecrets:
        {{- toYaml .Values.imagePullSecrets | nindent 8 }}
      {{- end }}
      containers:
      - name: worker
        image: "{{ .Values.imageRegistry }}/{{ .Values.imageRepository }}/{{ .Values.workers.dispatches.image.repository }}:{{ .Values.workers.dispatches.image.tag }}"
        imagePullPolicy: {{ .Values.pullPolicy | default "Always" }}
        securityContext:
          runAsUser: 0
        env:
        - name: TZ
          value: {{ .Values.config.timezone }}
        - name: GuardApi:Url
          value: "http://{{ include "poslite-pam.guardApiService" . }}:{{ .Values.guardApi.port }}/guard/status"
        - name: APP_UID
          value: "1654"
        - name: ASPNETCORE_HTTP_PORTS
          value: "8080"
        - name: ASPNETCORE_HTTPS_PORTS
          value: "8081"
        - name: PATH
          value: "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
        - name: PamTcpClient:IP
          valueFrom:
            configMapKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: pam-ip
        - name: PamTcpClient:Port
          value: "{{ .Values.config.pamTcpPort }}"
        - name: CoreApiClient:BaseUrl
          value: "http://{{ include "poslite-pam.coreWebapiService" . }}:{{ .Values.coreWebapi.port }}/"
        - name: CoreApiClient:ApiKey
          value: {{ .Values.config.coreApiKey | quote }}
        - name: PamScraperClient:BaseUrl
          value: "http://{{ include "poslite-pam.scraperService" . }}:{{ .Values.scraper.port }}/"
        - name: PamScraperClient:ApiKey
          value: {{ .Values.config.pamScraperApiKey | quote }}
        - name: DataWorkers:Dispatches:Enabled
          value: "true"
        - name: Company
          value: "1"
        - name: DOTNET_RUNNING_IN_CONTAINER
          value: "true"
        - name: DOTNET_VERSION
          value: "8.0.11"
        - name: ChunkSizeBySync
          value: "10"
        workingDir: /app
        resources:
          {{- toYaml .Values.resources | nindent 10 }}
      hostname: pam-dispatches-dataworker
      {{- with .Values.nodeSelector }}
      nodeSelector:
        {{- toYaml . | nindent 8 }}
      {{- end }}
{{- end }}

---
{{- if .Values.workers.shifts.enabled }}
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "poslite-pam.fullname" . }}-shifts-dataworker
  labels:
    {{- include "poslite-pam.labels" . | nindent 4 }}
    component: worker
    worker-type: shifts
spec:
  replicas: {{ .Values.workers.shifts.replicas }}
  selector:
    matchLabels:
      {{- include "poslite-pam.selectorLabels" . | nindent 6 }}
      component: worker
      worker-type: shifts
  template:
    metadata:
      labels:
        {{- include "poslite-pam.selectorLabels" . | nindent 8 }}
        component: worker
        worker-type: shifts
    spec:
      {{- if .Values.imagePullSecrets }}
      imagePullSecrets:
        {{- toYaml .Values.imagePullSecrets | nindent 8 }}
      {{- end }}
      containers:
      - name: worker
        image: "{{ .Values.imageRegistry }}/{{ .Values.imageRepository }}/{{ .Values.workers.shifts.image.repository }}:{{ .Values.workers.shifts.image.tag }}"
        imagePullPolicy: {{ .Values.pullPolicy | default "Always" }}
        securityContext:
          runAsUser: 0
        env:
        - name: TZ
          value: {{ .Values.config.timezone }}
        - name: GuardApi:Url
          value: "http://{{ include "poslite-pam.guardApiService" . }}:{{ .Values.guardApi.port }}/guard/status"
        - name: APP_UID
          value: "1654"
        - name: ASPNETCORE_HTTP_PORTS
          value: "8080"
        - name: ASPNETCORE_HTTPS_PORTS
          value: "8081"
        - name: PATH
          value: "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
        - name: PamTcpClient:IP
          valueFrom:
            configMapKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: pam-ip
        - name: PamTcpClient:Port
          value: "{{ .Values.config.pamTcpPort }}"
        - name: CoreApiClient:BaseUrl
          value: "http://{{ include "poslite-pam.coreWebapiService" . }}:{{ .Values.coreWebapi.port }}/"
        - name: CoreApiClient:ApiKey
          value: {{ .Values.config.coreApiKey | quote }}
        - name: PamScraperClient:BaseUrl
          value: "http://{{ include "poslite-pam.scraperService" . }}:{{ .Values.scraper.port }}/"
        - name: PamScraperClient:ApiKey
          value: {{ .Values.config.pamScraperApiKey | quote }}
        - name: DataWorkers:Shifts:Enabled
          value: "true"
        - name: Company
          value: "1"
        - name: DOTNET_RUNNING_IN_CONTAINER
          value: "true"
        - name: DOTNET_VERSION
          value: "8.0.11"
        - name: ChunkSizeBySync
          value: "10"
        workingDir: /app
        resources:
          {{- toYaml .Values.resources | nindent 10 }}
      hostname: pam-shifts-dataworker
      {{- with .Values.nodeSelector }}
      nodeSelector:
        {{- toYaml . | nindent 8 }}
      {{- end }}
{{- end }}

---
{{- if .Values.workers.totalizers.enabled }}
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "poslite-pam.fullname" . }}-totalizers-dataworker
  labels:
    {{- include "poslite-pam.labels" . | nindent 4 }}
    component: worker
    worker-type: totalizers
spec:
  replicas: {{ .Values.workers.totalizers.replicas }}
  selector:
    matchLabels:
      {{- include "poslite-pam.selectorLabels" . | nindent 6 }}
      component: worker
      worker-type: totalizers
  template:
    metadata:
      labels:
        {{- include "poslite-pam.selectorLabels" . | nindent 8 }}
        component: worker
        worker-type: totalizers
    spec:
      {{- if .Values.imagePullSecrets }}
      imagePullSecrets:
        {{- toYaml .Values.imagePullSecrets | nindent 8 }}
      {{- end }}
      containers:
      - name: worker
        image: "{{ .Values.imageRegistry }}/{{ .Values.imageRepository }}/{{ .Values.workers.totalizers.image.repository }}:{{ .Values.workers.totalizers.image.tag }}"
        imagePullPolicy: {{ .Values.pullPolicy | default "Always" }}
        securityContext:
          runAsUser: 0
        env:
        - name: TZ
          value: {{ .Values.config.timezone }}
        - name: GuardApi:Url
          value: "http://{{ include "poslite-pam.guardApiService" . }}:{{ .Values.guardApi.port }}/guard/status"
        - name: APP_UID
          value: "1654"
        - name: ASPNETCORE_HTTP_PORTS
          value: "8080"
        - name: ASPNETCORE_HTTPS_PORTS
          value: "8081"
        - name: PATH
          value: "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
        - name: PamTcpClient:IP
          valueFrom:
            configMapKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: pam-ip
        - name: PamTcpClient:Port
          value: "{{ .Values.config.pamTcpPort }}"
        - name: CoreApiClient:BaseUrl
          value: "http://{{ include "poslite-pam.coreWebapiService" . }}:{{ .Values.coreWebapi.port }}/"
        - name: CoreApiClient:ApiKey
          value: {{ .Values.config.coreApiKey | quote }}
        - name: PamScraperClient:BaseUrl
          value: "http://{{ include "poslite-pam.scraperService" . }}:{{ .Values.scraper.port }}/"
        - name: PamScraperClient:ApiKey
          value: {{ .Values.config.pamScraperApiKey | quote }}
        - name: DataWorkers:Totalizers:Enabled
          value: "true"
        - name: Company
          value: "1"
        - name: DOTNET_RUNNING_IN_CONTAINER
          value: "true"
        - name: DOTNET_VERSION
          value: "8.0.11"
        - name: ChunkSizeBySync
          value: "10"
        workingDir: /app
        resources:
          {{- toYaml .Values.resources | nindent 10 }}
      hostname: pam-totalizers-dataworker
      {{- with .Values.nodeSelector }}
      nodeSelector:
        {{- toYaml . | nindent 8 }}
      {{- end }}
{{- end }}

---
{{- if .Values.workers.tankstock.enabled }}
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "poslite-pam.fullname" . }}-tankstock-dataworker
  labels:
    {{- include "poslite-pam.labels" . | nindent 4 }}
    component: worker
    worker-type: tankstock
spec:
  replicas: {{ .Values.workers.tankstock.replicas }}
  selector:
    matchLabels:
      {{- include "poslite-pam.selectorLabels" . | nindent 6 }}
      component: worker
      worker-type: tankstock
  template:
    metadata:
      labels:
        {{- include "poslite-pam.selectorLabels" . | nindent 8 }}
        component: worker
        worker-type: tankstock
    spec:
      {{- if .Values.imagePullSecrets }}
      imagePullSecrets:
        {{- toYaml .Values.imagePullSecrets | nindent 8 }}
      {{- end }}
      containers:
      - name: worker
        image: "{{ .Values.imageRegistry }}/{{ .Values.imageRepository }}/{{ .Values.workers.tankstock.image.repository }}:{{ .Values.workers.tankstock.image.tag }}"
        imagePullPolicy: {{ .Values.pullPolicy | default "Always" }}
        securityContext:
          runAsUser: 0
        env:
        - name: TZ
          value: {{ .Values.config.timezone }}
        - name: GuardApi:Url
          value: "http://{{ include "poslite-pam.guardApiService" . }}:{{ .Values.guardApi.port }}/guard/status"
        - name: APP_UID
          value: "1654"
        - name: ASPNETCORE_HTTP_PORTS
          value: "8080"
        - name: ASPNETCORE_HTTPS_PORTS
          value: "8081"
        - name: PATH
          value: "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
        - name: PamTcpClient:IP
          valueFrom:
            configMapKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: pam-ip
        - name: PamTcpClient:Port
          value: "{{ .Values.config.pamTcpPort }}"
        - name: CoreApiClient:BaseUrl
          value: "http://{{ include "poslite-pam.coreWebapiService" . }}:{{ .Values.coreWebapi.port }}/"
        - name: CoreApiClient:ApiKey
          value: {{ .Values.config.coreApiKey | quote }}
        - name: PamScraperClient:BaseUrl
          value: "http://{{ include "poslite-pam.scraperService" . }}:{{ .Values.scraper.port }}/"
        - name: PamScraperClient:ApiKey
          value: {{ .Values.config.pamScraperApiKey | quote }}
        - name: DataWorkers:TankStock:Enabled
          value: "true"
        - name: Company
          value: "1"
        - name: DOTNET_RUNNING_IN_CONTAINER
          value: "true"
        - name: DOTNET_VERSION
          value: "8.0.11"
        - name: ChunkSizeBySync
          value: "10"
        workingDir: /app
        resources:
          {{- toYaml .Values.resources | nindent 10 }}
      hostname: pam-tankstock-dataworker
      {{- with .Values.nodeSelector }}
      nodeSelector:
        {{- toYaml . | nindent 8 }}
      {{- end }}
{{- end }}

---
{{- if .Values.workers.loyaltyConfig.enabled }}
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "poslite-pam.fullname" . }}-loyalty-config-worker
  labels:
    {{- include "poslite-pam.labels" . | nindent 4 }}
    component: worker
    worker-type: loyalty-config
spec:
  replicas: {{ .Values.workers.loyaltyConfig.replicas }}
  selector:
    matchLabels:
      {{- include "poslite-pam.selectorLabels" . | nindent 6 }}
      component: worker
      worker-type: loyalty-config
  template:
    metadata:
      labels:
        {{- include "poslite-pam.selectorLabels" . | nindent 8 }}
        component: worker
        worker-type: loyalty-config
    spec:
      {{- if .Values.imagePullSecrets }}
      imagePullSecrets:
        {{- toYaml .Values.imagePullSecrets | nindent 8 }}
      {{- end }}
      containers:
      - name: worker
        image: "{{ .Values.imageRegistry }}/{{ .Values.imageRepository }}/{{ .Values.workers.loyaltyConfig.image.repository }}:{{ .Values.workers.loyaltyConfig.image.tag }}"
        imagePullPolicy: {{ .Values.pullPolicy | default "Always" }}
        securityContext:
          runAsUser: 0
        env:
        - name: TZ
          value: {{ .Values.config.timezone }}
        - name: ConnectionStrings:CoreDbConnection
          valueFrom:
            secretKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: db-connection-string
        - name: ASPNETCORE_ENVIRONMENT
          value: "Development"
        - name: GuardApi:Url
          value: "http://{{ include "poslite-pam.guardApiService" . }}:{{ .Values.guardApi.port }}/guard/status"
        - name: CoreApiClient:BaseUrl
          value: "http://{{ include "poslite-pam.coreWebapiService" . }}:{{ .Values.coreWebapi.port }}/"
        - name: CoreApiClient:ApiKey
          value: {{ .Values.config.coreApiKey | quote }}
        - name: IerpApi:BaseUrl
          valueFrom:
            configMapKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: ierp-url
        - name: PROCESS
          value: "default"
        - name: Workers:LoyaltySync:CronExpression
          value: "*/5 * * * *"
        - name: Workers:LoyaltyConfig:CronExpression
          value: "0 * * * *"
        workingDir: /app
        resources:
          {{- toYaml .Values.resources | nindent 10 }}
      hostname: pam-core-loyalty-config-worker
      {{- with .Values.nodeSelector }}
      nodeSelector:
        {{- toYaml . | nindent 8 }}
      {{- end }}
{{- end }}

{{- if .Values.workers.ierp.enabled }}
---
{{- if .Values.workers.ierp.dispatchesToInvoice.enabled }}
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "poslite-pam.fullname" . }}-dispatches-to-invoice-worker
  labels:
    {{- include "poslite-pam.labels" . | nindent 4 }}
    component: worker
    worker-type: ierp
    ierp-worker: dispatches-to-invoice
spec:
  replicas: {{ .Values.workers.ierp.dispatchesToInvoice.replicas }}
  selector:
    matchLabels:
      {{- include "poslite-pam.selectorLabels" . | nindent 6 }}
      component: worker
      worker-type: ierp
      ierp-worker: dispatches-to-invoice
  template:
    metadata:
      labels:
        {{- include "poslite-pam.selectorLabels" . | nindent 8 }}
        component: worker
        worker-type: ierp
        ierp-worker: dispatches-to-invoice
    spec:
      {{- if .Values.imagePullSecrets }}
      imagePullSecrets:
        {{- toYaml .Values.imagePullSecrets | nindent 8 }}
      {{- end }}
      containers:
      - name: worker
        image: "{{ .Values.imageRegistry }}/{{ .Values.imageRepository }}/{{ .Values.workers.ierp.dispatchesToInvoice.image.repository }}:{{ .Values.workers.ierp.dispatchesToInvoice.image.tag }}"
        imagePullPolicy: {{ .Values.pullPolicy | default "Always" }}
        securityContext:
          runAsUser: 0
        env:
        - name: TZ
          value: {{ .Values.config.timezone }}
        - name: GuardApi:Url
          value: "http://{{ include "poslite-pam.guardApiService" . }}:{{ .Values.guardApi.port }}/guard/status"
        - name: CoreApiClient:BaseUrl
          value: "http://{{ include "poslite-pam.coreWebapiService" . }}:{{ .Values.coreWebapi.port }}/"
        - name: CoreApiClient:ApiKey
          value: {{ .Values.config.coreApiKey | quote }}
        - name: IerpApi:BaseUrl
          valueFrom:
            configMapKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: ierp-url
        - name: ConnectionStrings:CoreDbConnection
          valueFrom:
            secretKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: db-connection-string
        - name: PROCESS
          value: "pamdispatchestoinvoices"
        workingDir: /app
        resources:
          {{- toYaml .Values.resources | nindent 10 }}
      hostname: pam-dispatches-to-invoice-worker
      {{- with .Values.nodeSelector }}
      nodeSelector:
        {{- toYaml . | nindent 8 }}
      {{- end }}
{{- end }}

---
{{- if .Values.workers.ierp.dispatchPayments.enabled }}
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "poslite-pam.fullname" . }}-ierp-dispatch-payments-worker
  labels:
    {{- include "poslite-pam.labels" . | nindent 4 }}
    component: worker
    worker-type: ierp
    ierp-worker: dispatch-payments
spec:
  replicas: {{ .Values.workers.ierp.dispatchPayments.replicas }}
  selector:
    matchLabels:
      {{- include "poslite-pam.selectorLabels" . | nindent 6 }}
      component: worker
      worker-type: ierp
      ierp-worker: dispatch-payments
  template:
    metadata:
      labels:
        {{- include "poslite-pam.selectorLabels" . | nindent 8 }}
        component: worker
        worker-type: ierp
        ierp-worker: dispatch-payments
    spec:
      {{- if .Values.imagePullSecrets }}
      imagePullSecrets:
        {{- toYaml .Values.imagePullSecrets | nindent 8 }}
      {{- end }}
      containers:
      - name: worker
        image: "{{ .Values.imageRegistry }}/{{ .Values.imageRepository }}/{{ .Values.workers.ierp.dispatchPayments.image.repository }}:{{ .Values.workers.ierp.dispatchPayments.image.tag }}"
        imagePullPolicy: {{ .Values.pullPolicy | default "Always" }}
        securityContext:
          runAsUser: 0
        env:
        - name: TZ
          value: {{ .Values.config.timezone }}
        - name: GuardApi:Url
          value: "http://{{ include "poslite-pam.guardApiService" . }}:{{ .Values.guardApi.port }}/guard/status"
        - name: CoreApiClient:BaseUrl
          value: "http://{{ include "poslite-pam.coreWebapiService" . }}:{{ .Values.coreWebapi.port }}/"
        - name: CoreApiClient:ApiKey
          value: {{ .Values.config.coreApiKey | quote }}
        - name: IerpApi:BaseUrl
          valueFrom:
            configMapKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: ierp-url
        - name: ConnectionStrings:CoreDbConnection
          valueFrom:
            secretKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: db-connection-string
        - name: PROCESS
          value: "pamdispatchpayments"
        - name: Workers:PamDispatchPayments:CronExpression
          value: "*/10 * * * *"
        - name: Workers:PamDispatchPayments:BatchSize
          value: "100"
        workingDir: /app
        resources:
          {{- toYaml .Values.resources | nindent 10 }}
      hostname: pam-ierp-dispatch-payments-worker
      {{- with .Values.nodeSelector }}
      nodeSelector:
        {{- toYaml . | nindent 8 }}
      {{- end }}
{{- end }}

---
{{- if .Values.workers.ierp.invoicesToIerp.enabled }}
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "poslite-pam.fullname" . }}-invoices-to-ierp-worker
  labels:
    {{- include "poslite-pam.labels" . | nindent 4 }}
    component: worker
    worker-type: ierp
    ierp-worker: invoices-to-ierp
spec:
  replicas: {{ .Values.workers.ierp.invoicesToIerp.replicas }}
  selector:
    matchLabels:
      {{- include "poslite-pam.selectorLabels" . | nindent 6 }}
      component: worker
      worker-type: ierp
      ierp-worker: invoices-to-ierp
  template:
    metadata:
      labels:
        {{- include "poslite-pam.selectorLabels" . | nindent 8 }}
        component: worker
        worker-type: ierp
        ierp-worker: invoices-to-ierp
    spec:
      {{- if .Values.imagePullSecrets }}
      imagePullSecrets:
        {{- toYaml .Values.imagePullSecrets | nindent 8 }}
      {{- end }}
      containers:
      - name: worker
        image: "{{ .Values.imageRegistry }}/{{ .Values.imageRepository }}/{{ .Values.workers.ierp.invoicesToIerp.image.repository }}:{{ .Values.workers.ierp.invoicesToIerp.image.tag }}"
        imagePullPolicy: {{ .Values.pullPolicy | default "Always" }}
        securityContext:
          runAsUser: 0
        env:
        - name: TZ
          value: {{ .Values.config.timezone }}
        - name: GuardApi:Url
          value: "http://{{ include "poslite-pam.guardApiService" . }}:{{ .Values.guardApi.port }}/guard/status"
        - name: CoreApiClient:BaseUrl
          value: "http://{{ include "poslite-pam.coreWebapiService" . }}:{{ .Values.coreWebapi.port }}/"
        - name: CoreApiClient:ApiKey
          value: {{ .Values.config.coreApiKey | quote }}
        - name: IerpApi:BaseUrl
          valueFrom:
            configMapKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: ierp-url
        - name: ConnectionStrings:CoreDbConnection
          valueFrom:
            secretKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: db-connection-string
        - name: PROCESS
          value: "posliteinvoices"
        - name: Workers:PosLiteToIerpInvoices:BatchSize
          value: "50"
        workingDir: /app
        resources:
          {{- toYaml .Values.resources | nindent 10 }}
      hostname: pam-invoices-to-ierp-worker
      {{- with .Values.nodeSelector }}
      nodeSelector:
        {{- toYaml . | nindent 8 }}
      {{- end }}
{{- end }}

---
{{- if .Values.workers.ierp.customers.enabled }}
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "poslite-pam.fullname" . }}-ierp-customers-worker
  labels:
    {{- include "poslite-pam.labels" . | nindent 4 }}
    component: worker
    worker-type: ierp
    ierp-worker: customers
spec:
  replicas: {{ .Values.workers.ierp.customers.replicas }}
  selector:
    matchLabels:
      {{- include "poslite-pam.selectorLabels" . | nindent 6 }}
      component: worker
      worker-type: ierp
      ierp-worker: customers
  template:
    metadata:
      labels:
        {{- include "poslite-pam.selectorLabels" . | nindent 8 }}
        component: worker
        worker-type: ierp
        ierp-worker: customers
    spec:
      {{- if .Values.imagePullSecrets }}
      imagePullSecrets:
        {{- toYaml .Values.imagePullSecrets | nindent 8 }}
      {{- end }}
      containers:
      - name: worker
        image: "{{ .Values.imageRegistry }}/{{ .Values.imageRepository }}/{{ .Values.workers.ierp.customers.image.repository }}:{{ .Values.workers.ierp.customers.image.tag }}"
        imagePullPolicy: {{ .Values.pullPolicy | default "Always" }}
        securityContext:
          runAsUser: 0
        env:
        - name: TZ
          value: {{ .Values.config.timezone }}
        - name: GuardApi:Url
          value: "http://{{ include "poslite-pam.guardApiService" . }}:{{ .Values.guardApi.port }}/guard/status"
        - name: CoreApiClient:BaseUrl
          value: "http://{{ include "poslite-pam.coreWebapiService" . }}:{{ .Values.coreWebapi.port }}/"
        - name: CoreApiClient:ApiKey
          value: {{ .Values.config.coreApiKey | quote }}
        - name: IerpApi:BaseUrl
          valueFrom:
            configMapKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: ierp-url
        - name: ConnectionStrings:CoreDbConnection
          valueFrom:
            secretKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: db-connection-string
        - name: PROCESS
          value: "customers"
        - name: Workers:Customers:CronExpression
          value: "*/5 * * * *"
        workingDir: /app
        resources:
          {{- toYaml .Values.resources | nindent 10 }}
      hostname: pam-ierp-customers-worker
      {{- with .Values.nodeSelector }}
      nodeSelector:
        {{- toYaml . | nindent 8 }}
      {{- end }}
{{- end }}

---
{{- if .Values.workers.ierp.markets.enabled }}
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "poslite-pam.fullname" . }}-ierp-markets-worker
  labels:
    {{- include "poslite-pam.labels" . | nindent 4 }}
    component: worker
    worker-type: ierp
    ierp-worker: markets
spec:
  replicas: {{ .Values.workers.ierp.markets.replicas }}
  selector:
    matchLabels:
      {{- include "poslite-pam.selectorLabels" . | nindent 6 }}
      component: worker
      worker-type: ierp
      ierp-worker: markets
  template:
    metadata:
      labels:
        {{- include "poslite-pam.selectorLabels" . | nindent 8 }}
        component: worker
        worker-type: ierp
        ierp-worker: markets
    spec:
      {{- if .Values.imagePullSecrets }}
      imagePullSecrets:
        {{- toYaml .Values.imagePullSecrets | nindent 8 }}
      {{- end }}
      containers:
      - name: worker
        image: "{{ .Values.imageRegistry }}/{{ .Values.imageRepository }}/{{ .Values.workers.ierp.markets.image.repository }}:{{ .Values.workers.ierp.markets.image.tag }}"
        imagePullPolicy: {{ .Values.pullPolicy | default "Always" }}
        securityContext:
          runAsUser: 0
        env:
        - name: TZ
          value: {{ .Values.config.timezone }}
        - name: GuardApi:Url
          value: "http://{{ include "poslite-pam.guardApiService" . }}:{{ .Values.guardApi.port }}/guard/status"
        - name: CoreApiClient:BaseUrl
          value: "http://{{ include "poslite-pam.coreWebapiService" . }}:{{ .Values.coreWebapi.port }}/"
        - name: CoreApiClient:ApiKey
          value: {{ .Values.config.coreApiKey | quote }}
        - name: IerpApi:BaseUrl
          valueFrom:
            configMapKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: ierp-url
        - name: ConnectionStrings:CoreDbConnection
          valueFrom:
            secretKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: db-connection-string
        - name: PROCESS
          value: "markets"
        - name: Workers:Markets:CronExpression
          value: "*/5 * * * *"
        workingDir: /app
        resources:
          {{- toYaml .Values.resources | nindent 10 }}
      hostname: pam-ierp-markets-worker
      {{- with .Values.nodeSelector }}
      nodeSelector:
        {{- toYaml . | nindent 8 }}
      {{- end }}
{{- end }}

---
{{- if .Values.workers.ierp.basicData.enabled }}
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "poslite-pam.fullname" . }}-ierp-basic-data-worker
  labels:
    {{- include "poslite-pam.labels" . | nindent 4 }}
    component: worker
    worker-type: ierp
    ierp-worker: basic-data
spec:
  replicas: {{ .Values.workers.ierp.basicData.replicas }}
  selector:
    matchLabels:
      {{- include "poslite-pam.selectorLabels" . | nindent 6 }}
      component: worker
      worker-type: ierp
      ierp-worker: basic-data
  template:
    metadata:
      labels:
        {{- include "poslite-pam.selectorLabels" . | nindent 8 }}
        component: worker
        worker-type: ierp
        ierp-worker: basic-data
    spec:
      {{- if .Values.imagePullSecrets }}
      imagePullSecrets:
        {{- toYaml .Values.imagePullSecrets | nindent 8 }}
      {{- end }}
      containers:
      - name: worker
        image: "{{ .Values.imageRegistry }}/{{ .Values.imageRepository }}/{{ .Values.workers.ierp.basicData.image.repository }}:{{ .Values.workers.ierp.basicData.image.tag }}"
        imagePullPolicy: {{ .Values.pullPolicy | default "Always" }}
        securityContext:
          runAsUser: 0
        env:
        - name: TZ
          value: {{ .Values.config.timezone }}
        - name: GuardApi:Url
          value: "http://{{ include "poslite-pam.guardApiService" . }}:{{ .Values.guardApi.port }}/guard/status"
        - name: CoreApiClient:BaseUrl
          value: "http://{{ include "poslite-pam.coreWebapiService" . }}:{{ .Values.coreWebapi.port }}/"
        - name: CoreApiClient:ApiKey
          value: {{ .Values.config.coreApiKey | quote }}
        - name: IerpApi:BaseUrl
          valueFrom:
            configMapKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: ierp-url
        - name: ConnectionStrings:CoreDbConnection
          valueFrom:
            secretKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: db-connection-string
        - name: PROCESS
          value: "basicdata"
        - name: Workers:BasicData:CronExpression
          value: "* */1 * * *"
        workingDir: /app
        resources:
          {{- toYaml .Values.resources | nindent 10 }}
      hostname: pam-ierp-basic-data-worker
      {{- with .Values.nodeSelector }}
      nodeSelector:
        {{- toYaml . | nindent 8 }}
      {{- end }}
{{- end }}

---
{{- if .Values.workers.ierp.invoiceSeries.enabled }}
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "poslite-pam.fullname" . }}-ierp-invoice-series-worker
  labels:
    {{- include "poslite-pam.labels" . | nindent 4 }}
    component: worker
    worker-type: ierp
    ierp-worker: invoice-series
spec:
  replicas: {{ .Values.workers.ierp.invoiceSeries.replicas }}
  selector:
    matchLabels:
      {{- include "poslite-pam.selectorLabels" . | nindent 6 }}
      component: worker
      worker-type: ierp
      ierp-worker: invoice-series
  template:
    metadata:
      labels:
        {{- include "poslite-pam.selectorLabels" . | nindent 8 }}
        component: worker
        worker-type: ierp
        ierp-worker: invoice-series
    spec:
      {{- if .Values.imagePullSecrets }}
      imagePullSecrets:
        {{- toYaml .Values.imagePullSecrets | nindent 8 }}
      {{- end }}
      containers:
      - name: worker
        image: "{{ .Values.imageRegistry }}/{{ .Values.imageRepository }}/{{ .Values.workers.ierp.invoiceSeries.image.repository }}:{{ .Values.workers.ierp.invoiceSeries.image.tag }}"
        imagePullPolicy: {{ .Values.pullPolicy | default "Always" }}
        securityContext:
          runAsUser: 0
        env:
        - name: TZ
          value: {{ .Values.config.timezone }}
        - name: GuardApi:Url
          value: "http://{{ include "poslite-pam.guardApiService" . }}:{{ .Values.guardApi.port }}/guard/status"
        - name: CoreApiClient:BaseUrl
          value: "http://{{ include "poslite-pam.coreWebapiService" . }}:{{ .Values.coreWebapi.port }}/"
        - name: CoreApiClient:ApiKey
          value: {{ .Values.config.coreApiKey | quote }}
        - name: IerpApi:BaseUrl
          valueFrom:
            configMapKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: ierp-url
        - name: ConnectionStrings:CoreDbConnection
          valueFrom:
            secretKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: db-connection-string
        - name: PROCESS
          value: "invoiceseries"
        - name: Workers:InvoiceSeries:CronExpression
          value: "*/5 * * * *"
        workingDir: /app
        resources:
          {{- toYaml .Values.resources | nindent 10 }}
      hostname: pam-ierp-invoice-series-worker
      {{- with .Values.nodeSelector }}
      nodeSelector:
        {{- toYaml . | nindent 8 }}
      {{- end }}
{{- end }}

---
{{- if .Values.workers.ierp.products.enabled }}
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "poslite-pam.fullname" . }}-ierp-products-worker
  labels:
    {{- include "poslite-pam.labels" . | nindent 4 }}
    component: worker
    worker-type: ierp
    ierp-worker: products
spec:
  replicas: {{ .Values.workers.ierp.products.replicas }}
  selector:
    matchLabels:
      {{- include "poslite-pam.selectorLabels" . | nindent 6 }}
      component: worker
      worker-type: ierp
      ierp-worker: products
  template:
    metadata:
      labels:
        {{- include "poslite-pam.selectorLabels" . | nindent 8 }}
        component: worker
        worker-type: ierp
        ierp-worker: products
    spec:
      {{- if .Values.imagePullSecrets }}
      imagePullSecrets:
        {{- toYaml .Values.imagePullSecrets | nindent 8 }}
      {{- end }}
      containers:
      - name: worker
        image: "{{ .Values.imageRegistry }}/{{ .Values.imageRepository }}/{{ .Values.workers.ierp.products.image.repository }}:{{ .Values.workers.ierp.products.image.tag }}"
        imagePullPolicy: {{ .Values.pullPolicy | default "Always" }}
        securityContext:
          runAsUser: 0
        env:
        - name: TZ
          value: {{ .Values.config.timezone }}
        - name: GuardApi:Url
          value: "http://{{ include "poslite-pam.guardApiService" . }}:{{ .Values.guardApi.port }}/guard/status"
        - name: CoreApiClient:BaseUrl
          value: "http://{{ include "poslite-pam.coreWebapiService" . }}:{{ .Values.coreWebapi.port }}/"
        - name: CoreApiClient:ApiKey
          value: {{ .Values.config.coreApiKey | quote }}
        - name: IerpApi:BaseUrl
          valueFrom:
            configMapKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: ierp-url
        - name: ConnectionStrings:CoreDbConnection
          valueFrom:
            secretKeyRef:
              name: {{ include "poslite-pam.fullname" . }}-config
              key: db-connection-string
        - name: PROCESS
          value: "products"
        - name: Workers:Products:CronExpression
          value: "*/5 * * * *"
        workingDir: /app
        resources:
          {{- toYaml .Values.resources | nindent 10 }}
      hostname: pam-ierp-products-worker
      {{- with .Values.nodeSelector }}
      nodeSelector:
        {{- toYaml . | nindent 8 }}
      {{- end }}
{{- end }}
{{- end }}
