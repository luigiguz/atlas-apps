# Plantilla para tienda Core en Raspberry Pi (Pi 5 16GB). Recursos ajustados para 4 cores / 16 GB RAM.
# Copiar a atlas-stores/fleet/bundles/stores/ y renombrar store/hostnames al ID de la tienda.
defaultNamespace: poslite
targetCustomizations:
- name: db
  clusterSelector:
    matchLabels:
      atlas: "true"
      store: "tienda-core-ejemplo-rpi"
  helm:
    chart: poslite-db
    repo: oci://atlashelmrepo.azurecr.io/helm
    version: 1.0.0
    values:
      postgresql:
        timezone: "America/Panama"
        database: poslite
        user: sa
      persistence:
        enabled: true
        storageClass: local-path
        size: 20Gi
        accessMode: ReadWriteOnce
      resources:
        limits:
          cpu: 500m
          memory: 768Mi
        requests:
          cpu: 250m
          memory: 384Mi
      pgadmin:
        enabled: true
        defaultEmail: admin@admin.com
        resources:
          limits:
            cpu: 100m
            memory: 128Mi
          requests:
            cpu: 50m
            memory: 64Mi
- name: core
  clusterSelector:
    matchLabels:
      atlas: "true"
      store: "tienda-core-ejemplo-rpi"
  helm:
    chart: poslite-core
    repo: oci://atlashelmrepo.azurecr.io/helm
    version: 1.0.0
    values:
      resources:
        limits:
          cpu: 400m
          memory: 384Mi
        requests:
          cpu: 50m
          memory: 128Mi
      portal:
        enabled: true
        replicas: 1
      webapi:
        enabled: true
        replicas: 1
      workers:
        price:
          enabled: true
        shift:
          enabled: true
        errorReports:
          enabled: true
        ierp:
          enabled: true
- name: cloudflared-core
  clusterSelector:
    matchLabels:
      atlas: "true"
      store: "tienda-core-ejemplo-rpi"
  helm:
    chart: poslite-cloudflared-core
    repo: oci://atlashelmrepo.azurecr.io/helm
    version: 1.0.0
    values:
      replicas: 1
      hostNetwork: true
      config:
        tunnelId: ""
        credentialsFile: ""
        ingress:
          - hostname: tienda-core-ejemplo-rpi-10014.asptienda.com
            service: http://localhost:10014
          - hostname: tienda-core-ejemplo-rpi-10012.asptienda.com
            service: http://localhost:10012
          - hostname: tienda-core-ejemplo-rpi-5050.asptienda.com
            service: http://localhost:5050
          - hostname: tienda-core-ejemplo-rpi-5432.asptienda.com
            service: tcp://localhost:5432
          - service: http_status:404
